"use strict";(function($){var min=false;var nodeFormId="bx-soa-order-form";var kalinza={isMobile:{Android:function Android(){return navigator.userAgent.match(/Android/i)},BlackBerry:function BlackBerry(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function iOS(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function Opera(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function Windows(){return navigator.userAgent.match(/IEMobile/i)},any:function any(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},accordion:function accordion(){$(".accordion > li:eq(0) a.ttt333").addClass("active").next().slideDown();$(".accordion a.ttt333").click(function(e){var dropDown=$(this).closest("li").find("div.main");$(this).closest(".accordion").find("div.main").not(dropDown).slideUp();if($(this).hasClass("active")){$(this).removeClass("active")}else{$(this).closest(".accordion").find("a.ttt333 active").removeClass("active");$(this).addClass("active")}dropDown.stop(false,true).slideToggle();e.preventDefault()})},updateHeaderCart:function updateHeaderCart(){var cartCounter=$(".header__cart .count");$.ajax({url:"/ajax/",method:"post",dataType:"json",data:{action:"getCartItems"}}).done(function(data){cartCounter.text(data.items)})},removeCartItem:function removeCartItem(id){$.ajax({url:"/ajax/",type:"post",dataType:"json",data:{action:"deleteBasketItem",deleteBasketId:id}}).done(function(data){if(data){kalinza.updateHeaderCart();BX.Sale.OrderAjaxComponent.sendRequest("refreshOrderAjax")}else{$("#modal-error").modal()}})},changeQuantity:function changeQuantity(op,id,quan){$.ajax({url:"/ajax/",type:"post",data:{action:"basketChangeQuantity",op:op,id:id,quan:quan}}).done(function(data){if(data){kalinza.updateHeaderCart();BX.Sale.OrderAjaxComponent.sendRequest("refreshOrderAjax")}else{$("#modal-error").modal()}})},updateCart:function updateCart(){kalinza.updateHeaderCart();BX.Sale.OrderAjaxComponent.sendRequest("refreshOrderAjax")},setPersonType:function setPersonType(type_id){$.ajax({url:"/ajax/",type:"post",data:{action:"setPersonType",type_id:type_id}}).done(function(data){var result=BX.Sale.OrderAjaxComponent.result;BX.Sale.OrderAjaxComponent.result.PERSON_TYPE[0].CHECKED="";BX.Sale.OrderAjaxComponent.result.PERSON_TYPE[1].CHECKED="Y";BX.Sale.OrderAjaxComponent.init(BX.Sale.OrderAjaxComponent.params)})},resetFilter:function resetFilter(url){$.ajax({url:"/ajax/",type:"post",data:{action:"resetFilter",url:url}}).done(function(data){window.location.replace(location.pathname)})},addToCartDone:function addToCartDone(ths,data){this.updateHeaderCart();var res=$.parseJSON(data);if(res.error.code===200){$("#modal-updatecart").modal()}else{$("#modal-error").modal()}ths.attr("disabled",false)},stickyblock:function stickyblock(wrapper,end,parent){var stickyWrapper=wrapper;if(stickyWrapper.length>0){stickyWrapper.stickyBlock({top:0,end:{element:end,offset:0},parent:parent})}},phoneMask:function phoneMask(ths){if($.fn.inputmask){ths.inputmask({mask:"+7 (999) 999-99-99",placeholder:"*"})}},emailMask:function emailMask(ths){if($.fn.inputmask){new Inputmask("email").mask(ths)}},indexMask:function indexMask(ths){if($.fn.inputmask){ths.inputmask({mask:"999999",placeholder:"_"})}},innMask:function innMask(ths){if($.fn.inputmask){ths.inputmask({mask:"9999999999[99]",placeholder:"_"})}},masks:function masks(){var phoneInputs=[];var emailInputs=[];var indexInputs=[];var innInputs=[];phoneInputs.forEach(function(input){kalinza.phoneMask($(input))});emailInputs.forEach(function(input){kalinza.emailMask($(input))});indexInputs.forEach(function(input){kalinza.indexMask($(input))});innInputs.forEach(function(input){kalinza.innMask($(input))})},numberFormat:function numberFormat(number,decimals,dec_point,separator){number=(number+"").replace(/[^0-9+\-Ee.]/g,"");var n=!isFinite(+number)?0:+number,prec=!isFinite(+decimals)?0:Math.abs(decimals),sep=typeof separator==="undefined"?",":separator,dec=typeof dec_point==="undefined"?".":dec_point,s="",toFixedFix=function toFixedFix(n,prec){var k=Math.pow(10,prec);return""+(Math.round(n*k)/k).toFixed(prec)};s=(prec?toFixedFix(n,prec):""+Math.round(n)).split(".");if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)}if((s[1]||"").length<prec){s[1]=s[1]||"";s[1]+=new Array(prec-s[1].length+1).join("0")}return s.join(dec)},checkPrivacy:function checkPrivacy(){document.querySelector("[data-save-button]").disabled=document.getElementById("order-privacy").checked},getAddressFromFullString:function getAddressFromFullString(str){return str.replace(/Адрес:/g,"").replace(/(Телефон:)(.)+/g,"").trim()},setAddress:function setAddress(address){$("#soa-property-6").val(address).attr("readonly",true).closest(".bx-soa-customer-field").removeClass("has-error");$("#soa-property-16").val(address).attr("readonly",true).closest(".bx-soa-customer-field").removeClass("has-error")},resetAddress:function resetAddress(){$("#soa-property-6").val("").removeAttr("readonly").closest(".bx-soa-customer-field");$("#soa-property-16").val("").removeAttr("readonly").closest(".bx-soa-customer-field")},setPoliticsNoticeCookie:function setPoliticsNoticeCookie(){$.cookie("BITRIX_POLITICS_NOTICE",true,{expires:365,path:"/",secure:true})},scrollToTop:function scrollToTop(){var scrollingAtTop=$(document).scrollTop();if(scrollingAtTop>480&&!min){$("#scroll-to-top").fadeIn();min=true}if(scrollingAtTop<=480&&min){$("#scroll-to-top").fadeOut();min=false}}};var fixedHeader={fixed_header:".js-fixed-header",windowWidth:null,parentHeight:null,init:function init(){this.eventHandlers(this)},eventHandlers:function eventHandlers(obj){obj.windowWidth=$(window).width();obj.parentHeight=$(obj.fixed_header).parent().height();$(window).scroll(function(){if(obj.windowWidth<786){$(this).scrollTop()>=100?obj.headerHandler(obj,true):obj.headerHandler(obj,false)}})},headerHandler:function headerHandler(obj,bool){if(bool){$(obj.fixed_header).parent().css("height",obj.parentHeight);$(obj.fixed_header).addClass("is--fixed")}else{$(obj.fixed_header).parent().css("height","initial");$(obj.fixed_header).removeClass("is--fixed")}}};fixedHeader.init();kalinza.accordion();$(document).on("click",".js-modal",function(){var event=$(this).data("event"),modal=$(this).data("modal"),jsModal=$(".js-modal-"+modal);if(event==="show"){modal==="topnav"?jsModal.addClass("is--active"):jsModal.fadeIn();$("html body").css("overflow","hidden")}else if(event==="close"){$("html body").css("overflow","initial");modal==="topnav"?jsModal.removeClass("is--active"):jsModal.fadeIn()}});$(document).on("click",".js-submit",function(e){e.preventDefault();var ths=$(this);if(ths.attr("disabled")===true)return;ths.attr("disabled",true);var form=$("#"+ths[0].form.id);$.ajax({url:form.attr("action"),method:form.attr("method"),data:form.serialize()}).done(function(data){kalinza.updateHeaderCart();var res=$.parseJSON(data);if(res.error.code===200){$("#modal-updatecart").modal()}else{$("#modal-error").modal()}ths.attr("disabled",false)})});$(document).on("click",".bx-soa-item-remove",function(e){e.preventDefault();var ths=$(this),id=ths.children("button").data("id");var wait=BX.showWait(nodeFormId);kalinza.removeCartItem(id);BX.closeWait(nodeFormId,wait)});$(document).on("click",".basket-quantity",function(e){e.preventDefault();var ths=$(this),id=ths.data("id"),op=ths.data("op");var wait=BX.showWait(nodeFormId);kalinza.changeQuantity(op,id,1);BX.closeWait(nodeFormId,wait)});$(document).on("change input",".basket-quantity-value",function(e){var _this=this;e.stopPropagation();setTimeout(function(){var ths=$(_this),id=ths.data("id"),op="add",quan=ths.val(),min=ths.data("min"),max=ths.data("max");if(quan===""||parseInt(quan)<=min||parseInt(quan)>max||parseInt(quan)===0||parseInt(quan)>999999||isNaN(parseInt(quan))){$(_this).val($(_this).data("value"));return}var wait=BX.showWait(nodeFormId);kalinza.changeQuantity(op,id,quan);BX.closeWait(nodeFormId,wait)},1500)});$(document).on("click",".shopping-cart__cart-refresh",function(e){e.preventDefault();var wait=BX.showWait(nodeFormId);kalinza.updateCart();BX.closeWait(nodeFormId,wait)});$(document).on("keyup keypress keydown input focus blur","#product-quantity",function(e){var ths=$(this);var value=parseInt(ths.val());var min=parseInt(ths.attr("min"));var max=parseInt(ths.data("max"));var sendToProd=parseInt(ths.data("sendtoprod"));var quanStore=parseInt(ths.data("quanstore"));ths.attr("required",true);var btn={addToCart:$("#product-addtocart"),sendToProd:$("#sendtoproduction--button")};var info={descProd:$(".product-card__details-desc__prod"),descOrder:$(".product-card__details-desc__order")};btn.addToCart.attr("disabled",value<min||value>max||value>=sendToProd||value>quanStore||isNaN(value));value<sendToProd?info.descProd.addClass("error"):info.descProd.removeClass("error");value<min?info.descOrder.addClass("error"):info.descOrder.removeClass("error")});$(document).on("keyup keypress keydown input focus blur",'input[name="form_text_11"]',function(e){e.stopPropagation();var value=parseInt($(this).val());var src=$("#product-quantity");var sendToProd=parseInt(src.data("sendtoprod"));var price=src.data("price");var btn=$('input[name="web_form_submit"]');var info=$(".form-group--desc");var total=$(".form-group--total .value");btn.attr("disabled",value<sendToProd||isNaN(value));value<sendToProd||isNaN(value)?info.addClass("error"):info.removeClass("error");total.html(kalinza.numberFormat(value*price,2,","," "))});$(document).on("click","#sendtoproduction--button",function(e){var min=$(this).data("sendtoprod");var unit=$(this).data("unit");var inputValue=$("#product-quantity").val();var productId=$(this).data("product-id");var id="#modal-sendtoproduction";var price=$(this).data("price");if(inputValue<min){$(id+"-count").text(min);$(id+"-unit").text(unit);$(id+"-error").modal("show")}else{$('input[name="form_hidden_12"]').val(productId);$('input[name="form_text_11"]').val(inputValue);$(".form-group--measure").text(unit);$(".form-group--price").html($(".product__prices-actual.bulk").html());$(".form-group--desc").html($(".product-card__details-desc__prod").html());$(".form-group--total .value").html(kalinza.numberFormat(inputValue*price,2,","," "));$(id).modal("show")}});$(document).on("click",'a[data-target="#modal-product-question"]',function(){var pid=$(this).data("pid");$('input[name="form_hidden_16"]').val(pid)});function unWrapHiddens(){$(".topnav__menu-hiddens li").unwrap();$(".topnav__delimiter").insertBefore($(".topnav__menu li").eq(-3))}function wrapHiddens(obj){obj.wrapAll('<div class="topnav__menu-hiddens">')}$(document).on("click",".topnav__dots",function(){if($(".topnav__menu-hiddens").length>0){unWrapHiddens()}else{var menuItems=$(".topnav__menu li");if(menuItems.length>0){var arrHiddens=[];menuItems.each(function(){if($(this).css("display")==="none"){arrHiddens=$.merge(arrHiddens,$(this))}});wrapHiddens($(arrHiddens))}}}).on("click",".filter__action",function(e){var typeClass="."+$(this).data("type");var div=$(".filter__contents "+typeClass);if($(this).hasClass("reset")){e.stopPropagation();kalinza.resetFilter(window.location.href);return false}$(this).toggleClass("active");div.toggleClass("active");$(this).siblings(".filter__action:not("+typeClass+")").removeClass("active");div.siblings(":not("+typeClass+")").removeClass("active")}).on("click",'label[for="order-privacy"]',function(e){e.stopPropagation();kalinza.checkPrivacy()}).on("click",".bx-soa-pickup-list-item.bx-selected",function(){if($(this).length===1){kalinza.setAddress(kalinza.getAddressFromFullString($(this).find(".bx-soa-pickup-l-item-desc").text()))}}).on("click",".bx-soa-pp-company",function(){kalinza.resetAddress()}).on("click",".politics-notice .close-button",function(){kalinza.setPoliticsNoticeCookie();$(".politics-notice").stop().slideUp()}).on("click",".bx-pagination ul li a",function(e){e.preventDefault();var url=$(this)[0].href;$(".catalog-production__wrapper").load(url+" .catalog-production__products")});window.onresize=function(){unWrapHiddens();kalinza.scrollToTop()};window.onload=function(){var details_wrapper=$(".product-card__details-wholewrapper"),details_end=$(".product-card__end"),details_parent=$(".product-card__details"),details_tab_content=details_parent.find(".details-tab__content"),detail_tab_height=0,windowWidth=$(window).width();$(details_tab_content).children().each(function(i,e){if($(e).height()>detail_tab_height){detail_tab_height=$(e).height()}});$(details_tab_content).children().height(detail_tab_height);if(windowWidth>768){kalinza.stickyblock(details_wrapper,details_end,details_parent)}kalinza.masks()};$(document).ajaxComplete(function(){if($("#bx-soa-pickup").css("display")!=="none"){var pickupItemSelected=$(".bx-soa-pickup-list-item.bx-selected");if(pickupItemSelected.length===1){kalinza.setAddress(kalinza.getAddressFromFullString(pickupItemSelected.find(".bx-soa-pickup-l-item-desc").text()))}}else{kalinza.resetAddress()}if(BX("samovivoz")!==null){var addrDiv=BX.findChildByClassName(BX("samovivoz"),"sdek_pvzAddr");if(addrDiv!==null){var address=addrDiv.innerHTML;if(address!==""){kalinza.setAddress(kalinza.getAddressFromFullString(address))}}}kalinza.masks()});$(document).scroll(function(){kalinza.scrollToTop()});$("[href='#top']").mPageScroll2id()})(jQuery);